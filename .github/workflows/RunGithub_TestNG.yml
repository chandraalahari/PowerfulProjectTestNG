name: JAVA CI with MAVEN TestNG

on:
   push:
     branches: ["master","chandra_dev"]
   pull_request:
     branches: ["master","chandra_dev"]

jobs:
   build:
     runs-on: windows-latest
     env:
       BASE_URL: https://dev.onion.gnapitech.org
       CONTROLS_URL: https://chandu0609.github.io/SeleniumAllControlsRepo/Selenium_Practice.html
       BROWSER: chrome

     steps:
       - uses: actions/checkout@v4

       - name: Set up JDK 17
         uses: actions/setup-java@v4
         with:
          java-version: '17'
          distribution: 'temurin'
          cache: maven

       - name: Build with Maven TestNG (headless)  
         working-directory: ${{ github.workspace }}
         run: mvn verify -Dheadless=true -DBaseurl="${{env.BASE_URL}}" -DBrowser="${{env.BROWSER}}"
      
         # Publish Extent Report
       - name: Upload Extent Report
         if: always() 
         uses: actions/upload-artifact@v4
         with:
          name: extent-report
          path: target/extent-report

        # Publish Allure Results
       - name: Upload Allure Results
         if: always() 
         uses: actions/upload-artifact@v4
         with:
          name: allure-results
          path: target/allure-results

       # Upload Allure HTML Report
       - name: Upload Allure HTML
         if: always()
         uses: actions/upload-artifact@v4
         with:
          name: allure-report-html
          path: target/site/allure-maven-plugin
